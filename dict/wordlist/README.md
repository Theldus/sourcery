# Managing wordlists
While Aspell doesn't need explanations, Wordlist needs some clarification on how
it works and how to manage the dictionary. As expected, Wordlist is just an
abstraction layer around a list of words so that we can build our dictionary.

## How it works
Wordlist works through what is called a 'Minimal Perfect Hash' which, for a given
fixed set of keys (words), the 'MPH' can map each key a hash without collision,
which eventually translates to a low lookup time, even for large sets of keys
(thousands or even millions of keys).

There are a few options available for such, such as [GPerf](https://www.gnu.org/software/gperf/), [CMPH](http://cmph.sourceforge.net/),
and [MPH](https://github.com/Theldus/mph). GPerf is top-notch for small input
sizes (something like 10,000 keys) but completely unfeasible for larger sizes due
to the long time for '(M)PH' generation. 

CMPH, in turn, handles huge inputs very well, but it's a library, and I wouldn't
want to add more dependencies to the project.

MPH (project), on the other hand, fits perfectly well into the philosophy of the
project: for a given input (text file, one word per line), MPH generates a file .c
containing the hash function (perfect and minimal) for that input, which, once
generated the file, does not require the presence of MPH (such as CMPH) or even
the original text file (just like GPerf) also, MPH handles huge inputs very well
(better than CMPH in my tests).

Therefore, Sourcery uses a slightly modified version of MPH that fixes some bugs
and introduces small new features.

In the following sections is discussed the directory structure and the files
generated by MPH.

## File structure
The structure of files/directories looks like this:
```text
.
├── dict_wordlist.c
├── dict_wordlist.h
├── gen/
│   ├── Makefile
│   ├── gen.c
│   ├── mph/          (submodule, MPH source code)
│   └── wordlist.txt
├── hash_wordlist.c
└── wordlist.c
```
- **dict_wordlist{.c,.h}**: responsible for receiving a word or phrase and
verifying whether it is correct or not, dict_wordlist _uses_ the wordlist and
constitutes the abstraction layer of the Sourcery dictionaries. It is the
equivalent version of dict_aspell.c but for Wordlist. More on this in the
README.md of the previous folder (dict/).

- **\*_wordlist.c** (Auto-generated files):
  - **hash_wordlist.c**: direct output from MPH. Contains the source code of the
  perfect hash function generated from gen/wordlist.txt. All the magic resides
  here, do not try to understand this file. It is important to note that this
  file needn't to be shipped along with the project, since it can be generated
  dynamically whenever you want, but, taking it along with the Sourcery source
  code, allows us to build and use Wordlist even without using MPH, which
  I consider an advantage.
    
  - **wordlist.c**: direct output of gen. Since MPH only generates the hash
  function, it is also necessary at some point the original wordlist, so
  wordlist.c contains the source code that represents the wordlist.txt and the
  sizes of each word. This prevents us from having to read a text file every
  time Sourcery starts. Just like hash_wordlist.c, this file is also generated
  dynamically, and its presence in the source code is only for practicality
  purposes.
    
 - **gen/** (Wordlist helper functions and files):
   - **Makefile**: Responsible to generate wordlist.c and hash_wordlist.c (more
   about in the next section).
   - **gen.c**: Responsible to generate the wordlist.c.
   - **mph/**: MPH source tree (as a submodule).
   - **wordlist.txt**: Wordlist, this is the file you may want to change (or not).
   
## Editing wordlists.txt
Depending on your use case, you may want to change the default Sourcery wordlist,
which is quite simple:
- Edit what you want in `dict/wordlist/gen/wordlist.txt` (or `rev_wordlist.txt`,
always one word per line, with no blanks or empty lines.
- From the project's root directory:
```bash
# If updating wordlist.txt
$ make clean
$ make gen # Generate the new hash table and wordlist
$ make     # Builds the program again

# If updating rev_wordlist.txt
$ make clean
$ make gen CHECK=reverse
$ make CHECK=reverse
```
`make gen` will turn everything into lower case, sort, remove duplicate entries
(so don't have to worry about it), and generate `(rev_)hash_wordlist.c` and
`(rev_)wordlist.c` in the appropriate locations. Just note that to generate a new
wordlist, it is necessary that the project folder has been obtained via a 'clone'
not a '.zip' from the Git repository, since MPH is a submodule and necessary to
generate new hash tables.

## If you are willing to send a Pull Request
You must send the updated .txt of the wordlist, as well as the files generated by
'make gen', that is:
- `(rev_)wordlist.txt`
- `(rev_)hash_wordlist.c`
- `(rev_)wordlist.c`

This requirement is to make the PR/commit a 'single' unit and not require additional
PRs/commits to make it functional. Please also list the license used by the wordlist
if any.

---
If you don't want to go through all that, just send a message to issue
[#1](https://github.com/Theldus/sourcery/issues/1) pointing out the words you want to
add and the license of them (if any).
